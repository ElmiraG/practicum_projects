# Предсказание стоимости жилья


**Описание проекта**


Необходимо обучить модель линейной регрессии на данных о жилье в Калифорнии в 1990 году. На основе данных предсказать медианную стоимость дома в жилом массиве. Обучить модель и сделать предсказания на тестовой выборке. Для оценки качества модели использовать метрики RMSE, MAE и R2.

## План по выполнению проекта
1. Инициализация локальной Spark-сессии
2. Загрузка данных
3. Предобработка и исследовательский анализ данных
4. Проверка на мультиколлинеарность
5. Отбор набора обучающих признаков
6. Обучение моделей
7. Итоговая оценка качества предсказания лучшей модели
8. Анализ результатов
9. Отчет по исследованию

## Описание данных
**Данные:**

- **/datasets/housing.csv** - данные о жилье в Калифорнии в 1990 году
- **median_house_value** — целевой признак, медианная стоимость дома в жилом массиве

## Вывод

1. **Инициализация локальной Spark-сессии**
Для обработки данных и построения моделей использовалась локальная Spark-сессия.
2. **Предобработка и исследование данных**
Выявление и замена типов данных:
   - Признак "ocean_proximity" (близость к океану) категориальный, остальные численные.
   - Признаки "housing_median_age", "total_rooms", "total_bedrooms", "population", "households" заменены на integer.
   - В датафрейме обнаружен 1% пропущенных данных в "total_bedrooms". Для заполнения использован класс Imputer.
Анализ данных:
   - Основные жилые массивы находятся во внутренних районах Калифорнии и в пределах часа езды от океана.
   - Два густонаселенных района: NEAR BAY (северо-запад, рядом с заливом) и <1H OCEAN (южное побережье, менее часа езды от океана). В последних расположены самые дорогостоящие дома.
   - Средний медианный возраст домов составляет 29 лет.
   - Распределение возраста домов нормальное с тремя пиками около 16, 35 и 50 лет, что может указывать на массовую застройку в эти годы.
   - Новые жилые кварталы (возраст здания до 20 лет) в основном находятся в материковой части Калифорнии (INLAND) и в радиусе часа езды от океана. Более старые дома также находятся в этом радиусе и около залива.
   - В данных присутствуют как частные дома, так и многоквартирные. Однако в основном преобладают многоквартирные дома.
   - Распределение общего количества комнат, спален, проживающих в жилом массиве и домовладельцев практически экспоненциальное, с уменьшением распространенности по мере увеличения значения признака.
   - Медианный доход варьируется от 5 до 150 тысяч долларов.
   - Люди с высоким доходом предпочитают жить в пределах часа езды до океана или около залива. Самые дорогостоящие жилые массивы также привлекают людей с высоким доходом.
   - Медианная стоимость дома в жилом массиве в пределах 14.999-500 011 долларов, в среднем 179.7 тыс. долларов.
   - Медианная стоимость домов распределена нормально с перекосом вправо: по мере увеличения стоимости домов их количество уменьшается, но на пиковой стоимости резко возрастает.
3. **Проверка на мультиколлинеарность**
В процессе расчета корреляции были определены сильнокоррелирующие пары признаков:
- longitude - latitude (-0.87)
- total_rooms - total_bedrooms (0.82)
- total_rooms - population (0.91)
- total_bedrooms - population (0.9)

Для сохранения информации из коррелирующих признаков без снижения производительности модели были созданы новые синтетические признаки:

- Отношение количества комнат total_rooms к количеству домовладений households (колонка rooms_per_household).
- Отношение количества жителей population к количеству домовладений households (колонка population_in_household).
- Отношение количества спален total_bedrooms к общему количеству комнат total_rooms (колонка bedroom_index).

Изначальные коррелирующие признаки были удалены, за исключением pair longitude-latitude. Было решено в дальнейшем проверить, как наличие одного из признаков или отсутствие обоих может повлиять на результаты модели.

Категориальный признак ocean_proximity не участвовал в проверке на мультиколлинеарность.

4. **Отбор набора обучающих признаков**

Для построения модели линейной регрессии были выбраны два набора данных:

- С использованием всех данных из файла.
- С использованием только числовых переменных.

Также было проверено, как наличие одного из признаков координат (ширины и долготы) или отсутствие обоих может повлиять на результаты модели.

5. **Обучение моделей**

Для построения модели использовались LinearRegression и GBTRegressor из модуля MLlib. Пайплайн состоял из следующих трансформаций:

- StringIndexer: преобразование категориальных признаков в числовые значения.
- OneHotEncoder: преобразование числовых индексов в разреженные векторы.
- VectorAssembler: объединение всех признаков в один вектор.
- StandardScaler: нормализация числовых признаков.
- LinearRegression или GBTRegressor.

Для оценки результатов применялись метрики RMSE, MAE и R2.

Модель GBTRegressor показала лучший результат по сравнению с LinearRegression.
Модель LinearRegression показала лучшие результаты с использованием категориального признака ocean_proximity (близость к океану) без признаков координат.
Модель GBTRegressor с использованием категориального признака ocean_proximity и с признаком latitude показала следующие метрики лучшей модели:

- Root Mean Squared Error (RMSE) = 58510
- Mean Absolute Error (MAE) = 41159
- R2 на тестовых данных = 0.74

6. **Анализ результатов**

Модель определяла медианную стоимость дома в жилом массиве по следующим признакам:

- population_in_household (отношение количества жителей к количеству домовладений)
- ocean_proximity (близость к океану)
- housing_median_age (медианный возраст жителей жилого массива)
- rooms_per_household (отношение количества комнат к количеству домовладений)
- bedroom_index (отношение количества спален total_bedrooms к общему количеству комнат)
- наименьшее значение у признаков median_income (медианный доход жителей жилого массива) и latitude (долгота)
