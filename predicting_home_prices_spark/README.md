# Предсказание стоимости жилья


**Описание проекта**


Необходимо обучить модель линейной регрессии на данных о жилье в Калифорнии в 1990 году. На основе данных предсказать медианную стоимость дома в жилом массиве. Обучить модель и сделать предсказания на тестовой выборке. Для оценки качества модели использовать метрики RMSE, MAE и R2.

# План по выполнению проекта
1. Инициализация локальной Spark-сессии
2. Загрузка данных
3. Предобработка и исследовательский анализ данных
4. Проверка на мультиколлинеарность
5. Отбор набора обучающих признаков
6. Обучение моделей
7. Итоговая оценка качества предсказания лучшей модели
8. Анализ результатов
9. Отчет по исследованию

# Описание данных
**Данные:**

- **/datasets/housing.csv** - данные о жилье в Калифорнии в 1990 году
- **median_house_value** — целевой признак, медианная стоимость дома в жилом массиве

## Отчет по исследованию
**1. Инициализирована локальная Spark-сессия**

**2. Проведена предобработка и исследование данных:**


- Выявлено, что признак ocean_proximity (близость к океану) категориальный, остальные численные
- Для признаков housing_median_age, total_rooms, total_bedrooms,  population, households тип данных заменен на integer
- В датафрейме пропущен 1% данных - пропуски в total_bedrooms (общее количество спален в домах жилого массива). Для заполнения пропусков использовался класс Imputer.

![image-6.png](attachment:image-6.png) 
- Основные жилые массивы находятся во внутренних районах Калифорнии и на расстоянии часа езды от океана.
- Существуют два густонаселенных района: на северо-западе рядом с заливом (NEAR BAY) и на южном побережье в радиусе менее часа езды от океана (<1H OCEAN), в последних расположены самые дорогостоящие дома.


- Средний медианный возраст домов в жилых массивах составляет 29 лет.
- Распределение медианного возраста домов в жилых массивах нормальное, с тремя пиками возраста около 16, 35 и 50 лет. Это может указывать на массовую застройку в эти годы.
- Новые жилые кварталы (возраст здания до 20 лет) в основном находятся в материковой части Калифорнии (INLAND) и в радиусе часа езды до океана. Более старые дома находятся также в радиусе часа езды до океана и около залива.


- В данных присутствуют как частные дома, так и многоквартирные. Однако в основном преобладают многоквартирные дома.
- Распределение общего количества комнат, спален, проживающих в жилом массиве и домовладельцев практически экспоненциальное, с уменьшением распространенности по мере увеличения значения признака.


- Медианный доход варьируется от 5 до 150 тысяч долларов.
- Люди с высоким доходом предпочитают жить в жилых массивах, находящихся в пределах часа езды до океана или около залива. Самые дорогостоящие жилые массивы также привлекают людей с высоким доходом.


- Медианная стоимость дома в жилом массиве в пределах 14.999-500 001 долларов, в среднем 179.7 тыс. долларов.
- В основном, медианная стоимость домов распределена нормально с перекосом вправо: по мере увеличения стоимости домов их количество уменьшается, но на пиковой стоимости резко возрастает. 

- Предобработка и исследование данных проведены с использованием методов pySpark

**3. Проверка на мультиколлинеарность:**
3.1. В процессе рассчета корреляции были определены сильнокоррелирующие пары признаков:
- `longitude` - `latitude` (-0.87)

- `total_rooms` - `total_bedrooms` (0.82)
- `total_rooms` - `population` (0.91)

- `total_bedrooms` - `population` (0.9)

3.2. Для того, чтобы сохранить информацию из коррелирующих признаках без снижения производительности модели - были созданы новые синтетические признаки:

- Отношение количества комнат `total_rooms` к количеству домовладений `households`. Колонка `rooms_per_household`.
- Отношение количества жителей `population` к количеству домовладений `households`. Колонка `population_in_household`.
- Отношение количества спален `total_bedrooms` к общему количеству комнат `total_rooms`. Колонка `bedroom_index`.

3.3. Изначальные коррелирующие признаки удалены, за исключением пары `longitude`-`latitude`. Было решено в дальнейшем проверить как наличие одного из признаков или отсутствие обоих может повлиять на результаты модели

3.4. Категориальный признак `ocean_proximity` не участвовал в проверке на мультиколлинеарность

**4.  Отбор набора обучающих признаков**

Для построения модели линейной регрессии выбраны два набора данных:

- с использованием всех данных из файла;
- с использованием только числовых переменных.

Также проверено как наличие одного из признаков координат (ширины и долготы) или отсутствие обоих может повлиять на результаты модели.

**5. Обучение моделей**

Для построения модели использовались LinearRegression и GBTRegressor из модуля MLlib, пайплайн состоял из следующих трансформаций:

- StringIndexer: преобразование категориальных признаков в числовые значения.

- OneHotEncoder: преобразование числовых индексов в разреженные векторы.

- VectorAssembler: объединение всех признаков в один вектор.

- StandardScaler: нормализация числовых признаков.

- LinearRegression или GBTRegressor

Для оценки результатов применяются метрики RMSE, MAE и R2.

- Модель GBTRegressor показала лучший результат по сравнению с LinearRegression

- Модель LinearRegression показала лучшие результаты с использованием категориального признака `ocean_proximity` (близость к океану) без признаков координат. 

- Модель GBTRegressor - с использованием категориального признака `ocean_proximity` (близость к океану) и с признаком `latitude` (долгота), метрики лучшей модели:
  - Root Mean Squared Error (RMSE)  = **58510**
  - Mean Absolute Error (MAE) = **41159**
  - R2 на тестовых данных = **0.74**

- Модель GBTRegressor показала лучший результат по сравнению с LinearRegression
**6. Анализ результатов**

Модель определяла медианную стоимость дома в жилом массиве, в основном, по таким признакам как:
- population_in_household  (отношение количества жителей к количеству домовладений)
- ocean_proximity  (близость к океану)
- housing_median_age (медианный возраст жителей жилого массива)
- rooms_per_household  (отношение количества комнат к количеству домовладений)
- bedroom_index (отношение количества спален total_bedrooms к общему количеству комнат)

- наименьшее значение у признаков median_income (медианный доход жителей жилого массива) и latitude (долгота)
